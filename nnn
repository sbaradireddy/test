CASE
  WHEN DMV_TRANS_TYPE = 'NB' AND SUBSTR(POL_VRSN_TXN_TYP, 1, 2) != 'EN' THEN 'N'
  WHEN DMV_TRANS_TYPE = 'RS' AND REINST_TYP = 'WITH LAPSE' THEN 'N'
  WHEN DMV_TRANS_TYPE = 'CN' AND ROW_STAT = 'C' THEN 'N' -- Explicitly handle 'C'
  WHEN DMV_TRANS_TYPE = 'CN' AND ROW_STAT = 'H' THEN 'Y' -- Explicitly handle 'H'
  WHEN DMV_TRANS_TYPE = 'CN' AND ROW_STAT NOT IN ('C', 'H') 
       AND POL_PK_REINSTATED_WITH_LAPSE > 0 
       AND POL_PK_REINSTATED_WITH_LAPSE > POL_PK THEN 'N'
  WHEN DMV_TRANS_TYPE = 'RS' AND REINST_TYP = 'REINSTATE' 
       AND ROW_STAT = 'C' 
       AND ISNULL(POL_PK_CANCEL) THEN 'N'
  WHEN DMV_TRANS_TYPE = 'AV' AND POL_PK = POL_PK_ADD_VEH THEN 'N'
  ELSE 'Y'
END AS FILTER_OUT_IND











CASE
  WHEN DMV_TRANS_TYPE = 'NB' AND SUBSTR(POL_VRSN_TXN_TYP, 1, 2) != 'EN' THEN 'N'
  WHEN DMV_TRANS_TYPE = 'RS' AND REINST_TYP = 'WITH LAPSE' THEN 'N'
  WHEN DMV_TRANS_TYPE = 'CN' AND ROW_STAT = 'C' THEN 'N'
  WHEN DMV_TRANS_TYPE = 'CN' AND ROW_STAT != 'C' 
       AND POL_PK_REINSTATED_WITH_LAPSE > 0 
       AND POL_PK_REINSTATED_WITH_LAPSE > POL_PK THEN 'N'
  WHEN DMV_TRANS_TYPE = 'RS' AND REINST_TYP = 'REINSTATE' 
       AND ROW_STAT = 'C' 
       AND ISNULL(POL_PK_CANCEL) THEN 'N'
  WHEN DMV_TRANS_TYPE = 'AV' AND POL_PK = POL_PK_ADD_VEH THEN 'N'
  ELSE 'Y'
END AS FILTER_OUT_IND














IIF(DMV_TRANS_TYPE = 'NB' AND SUBSTR(POL_VRSN_TXN_TYP,1,2)  != 'EN', 'N',
IIF(DMV_TRANS_TYPE = 'RS' AND REINST_TYP = 'WITH LAPSE', 'N',
IIF(DMV_TRANS_TYPE = 'CN' AND ROW_STAT = 'C', 'N',
IIF(DMV_TRANS_TYPE = 'CN' AND ROW_STAT  != 'C' 
AND POL_PK_REINSTATED_WITH_LAPSE > 0 AND POL_PK_REINSTATED_WITH_LAPSE > POL_PK, 'N',
IIF(DMV_TRANS_TYPE = 'RS' AND REINST_TYP = 'REINSTATE' AND ROW_STAT =  'C'  AND ISNULL(POL_PK_CANCEL), 'N',
IIF(DMV_TRANS_TYPE = 'AV' AND POL_PK = POL_PK_ADD_VEH, 'N',
'Y'))))))
