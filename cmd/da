
-- Check transformed date for HEADER
SELECT 
    DMV_INS_COMPANY_CD, 
    DMV_ORIG_CYCLE_DUE_DATE, 
    SUBSTR(DMV_ORIG_CYCLE_DUE_DATE, 5, 2) || SUBSTR(DMV_ORIG_CYCLE_DUE_DATE, 7, 2) || SUBSTR(DMV_ORIG_CYCLE_DUE_DATE, 1, 4) AS transformed_date
FROM 
    BURRPT.NJ_DMV_MTHLY_MERGE_HEADER_DW
WHERE 
    DMV_INS_COMPANY_CD IN (4840, 4876, 4875, 4895, 4946, 4927);

-- Check transformed date for lkp_VERSION_NBR
SELECT 
    DMV_INS_COMPANY_CD, 
    DMV_ORIG_CYCLE_DUE_DATE AS lkp_DMV_ORIG_CYCLE_DUE_DATE,
    TRY_TO_DATE(DMV_ORIG_CYCLE_DUE_DATE, 'MMDDYYYY') AS transformed_lkp_date
FROM 
    BURRPT.NJ_DMV_MTHLY_MERGE_HEADER_DW
WHERE 
    DMV_INS_COMPANY_CD IN (4840, 4876, 4875, 4895, 4946, 4927)
QUALIFY ROW_NUMBER() OVER (PARTITION BY DMV_INS_COMPANY_CD ORDER BY DMV_ORIG_CYCLE_DUE_DATE) = 1;












ON 
    lkp_VERSION_NBR.DMV_INS_COMPANY_CD = HEADER.DMV_INS_COMPANY_CD
    AND TRY_TO_DATE(SUBSTR(HEADER.DMV_ORIG_CYCLE_DUE_DATE, 5, 2) || SUBSTR(HEADER.DMV_ORIG_CYCLE_DUE_DATE, 7, 2) || SUBSTR(HEADER.DMV_ORIG_CYCLE_DUE_DATE, 1, 4), 'MMDDYYYY') = TRY_TO_DATE(lkp_VERSION_NBR.DMV_ORIG_CYCLE_DUE_DATE, 'MMDDYYYY')
    AND lkp_VERSION_NBR.ROW_ORIGIN = HEADER.ROW_ORIGIN
